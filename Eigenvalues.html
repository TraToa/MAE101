<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ch√©o h√≥a Ma tr·∫≠n</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjs@12.3.0/lib/browser/math.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input[type='number'] { width: 60px; text-align: center; }
    table { border-collapse: collapse; margin-top: 10px; }
    td { padding: 5px; }
    pre { background: #f0f0f0; padding: 10px; border-radius: 6px; white-space: pre-wrap; }
    .matrix-input td { border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>üî¢ Ch√©o h√≥a Ma tr·∫≠n</h2>

  <label>Nh·∫≠p k√≠ch th∆∞·ªõc ma tr·∫≠n vu√¥ng (n):</label>
  <input type="number" id="matrixSize" min="1" max="10" value="2" />
  <button onclick="generateMatrix()">T·∫°o ma tr·∫≠n</button>

  <div id="matrixArea"></div>
  <div id="calcButtonArea" style="margin-top: 10px;"></div>
  <div id="output" style="margin-top: 20px;"></div>

  <script>
    function generateMatrix() {
      const n = parseInt(document.getElementById('matrixSize').value);
      const area = document.getElementById('matrixArea');
      const buttonArea = document.getElementById('calcButtonArea');
      area.innerHTML = '';
      buttonArea.innerHTML = '';
      if (isNaN(n) || n <= 0) return;

      const table = document.createElement('table');
      table.className = 'matrix-input';

      for (let i = 0; i < n; i++) {
        const row = document.createElement('tr');
        for (let j = 0; j < n; j++) {
          const cell = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'number';
          input.step = 'any';
          input.id = `cell-${i}-${j}`;
          input.value = (i === j) ? 1 : 0;
          cell.appendChild(input);
          row.appendChild(cell);
        }
        table.appendChild(row);
      }

      area.appendChild(document.createElement('p')).textContent = `Nh·∫≠p ph·∫ßn t·ª≠ ma tr·∫≠n ${n}√ó${n}:`;
      area.appendChild(table);

      const btn = document.createElement('button');
      btn.textContent = 'T√≠nh to√°n';
      btn.onclick = () => diagonalize(n);
      buttonArea.appendChild(btn);
    }

    function diagonalize(n) {
      const output = document.getElementById('output');
      output.innerHTML = '';
      try {
        const A = [];
        for (let i = 0; i < n; i++) {
          const row = [];
          for (let j = 0; j < n; j++) {
            const value = parseFloat(document.getElementById(`cell-${i}-${j}`).value);
            if (isNaN(value)) throw new Error(`√î (${i + 1}, ${j + 1}) kh√¥ng h·ª£p l·ªá.`);
            row.push(value);
          }
          A.push(row);
        }

        const matrix = math.matrix(A);
        const eigen = math.eigs(matrix);

        // T·∫°o ma tr·∫≠n ch√©o D th·ªß c√¥ng
        const D = [];
        for (let i = 0; i < n; i++) {
          const row = new Array(n).fill(0);
          row[i] = eigen.values[i];
          D.push(row);
        }

        // Vector ri√™ng: c√°c c·ªôt trong eigen.eigenvectors
        const P = math.transpose(math.matrix(eigen.eigenvectors));
        const detP = math.det(P);
        const invertible = Math.abs(detP) > 1e-8;
        const Pinv = invertible ? math.inv(P) : 'Kh√¥ng kh·∫£ ngh·ªãch';

        output.innerHTML += `<h3>Gi√° tr·ªã ri√™ng:</h3><pre>${JSON.stringify(eigen.values)}</pre>`;
        output.innerHTML += `<h3>Vector ri√™ng (c·ªôt):</h3><pre>${JSON.stringify(eigen.eigenvectors, null, 2)}</pre>`;
        output.innerHTML += `<h3>Ma tr·∫≠n D (ch√©o):</h3><pre>${JSON.stringify(D, null, 2)}</pre>`;
        output.innerHTML += `<h3>Ma tr·∫≠n P (vector ri√™ng x·∫øp h√†ng):</h3><pre>${JSON.stringify(P._data, null, 2)}</pre>`;
        output.innerHTML += `<h3>Ma tr·∫≠n P‚Åª¬π:</h3><pre>${typeof Pinv === 'string' ? Pinv : JSON.stringify(Pinv._data, null, 2)}</pre>`;
        output.innerHTML += `<h3>C√≥ ch√©o h√≥a ƒë∆∞·ª£c kh√¥ng?</h3><pre>${invertible ? '‚úîÔ∏è C√≥' : '‚ùå Kh√¥ng'}</pre>`;
      } catch (err) {
        output.innerHTML = `<p style="color:red;"><strong>L·ªói:</strong> ${err.message}</p>`;
      }
    }

    window.onload = generateMatrix;
  </script>
</body>
</html>
